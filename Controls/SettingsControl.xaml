<UserControl x:Class="Buddie.Controls.SettingsControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:Buddie.Controls"
             xmlns:controls="clr-namespace:Buddie.Controls">
    
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Resources/SharedResources.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            
            <!-- 现代化Toggle开关样式 -->
            <Style x:Key="ModernToggleStyle" TargetType="CheckBox">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="CheckBox">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <ContentPresenter Grid.Column="0" 
                                                  VerticalAlignment="Center"
                                                  Margin="0,0,10,0"/>
                                
                                <Border Grid.Column="1"
                                        x:Name="ToggleBackground"
                                        Width="44"
                                        Height="24"
                                        CornerRadius="12"
                                        Background="#E4E4E7"
                                        BorderThickness="0"
                                        Cursor="Hand">
                                    <Ellipse x:Name="ToggleButton"
                                             Width="18"
                                             Height="18"
                                             Fill="White"
                                             HorizontalAlignment="Left"
                                             Margin="3,0,0,0">
                                        <Ellipse.Effect>
                                            <DropShadowEffect Color="Black" 
                                                              Direction="270" 
                                                              ShadowDepth="1" 
                                                              Opacity="0.3" 
                                                              BlurRadius="3"/>
                                        </Ellipse.Effect>
                                        <Ellipse.RenderTransform>
                                            <TranslateTransform x:Name="ToggleTransform"/>
                                        </Ellipse.RenderTransform>
                                    </Ellipse>
                                </Border>
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsChecked" Value="True">
                                    <Trigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <ColorAnimation Storyboard.TargetName="ToggleBackground"
                                                                Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"
                                                                To="#10B981"
                                                                Duration="0:0:0.2"/>
                                                <DoubleAnimation Storyboard.TargetName="ToggleTransform"
                                                                 Storyboard.TargetProperty="X"
                                                                 To="20"
                                                                 Duration="0:0:0.2">
                                                    <DoubleAnimation.EasingFunction>
                                                        <CubicEase EasingMode="EaseOut"/>
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.EnterActions>
                                    <Trigger.ExitActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <ColorAnimation Storyboard.TargetName="ToggleBackground"
                                                                Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"
                                                                To="#E4E4E7"
                                                                Duration="0:0:0.2"/>
                                                <DoubleAnimation Storyboard.TargetName="ToggleTransform"
                                                                 Storyboard.TargetProperty="X"
                                                                 To="0"
                                                                 Duration="0:0:0.2">
                                                    <DoubleAnimation.EasingFunction>
                                                        <CubicEase EasingMode="EaseOut"/>
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </Trigger.ExitActions>
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="ToggleBackground" Property="Opacity" Value="0.8"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </UserControl.Resources>
    
    <!-- 设置界面 - 位于右下角CardContainer附近 -->
    <Border x:Name="SettingsInterface"
            Width="460"
            Height="700"
            CornerRadius="10"
            HorizontalAlignment="Right"
            VerticalAlignment="Bottom"
            Margin="0,0,38,160"
            Effect="{StaticResource CardShadow}"
            Visibility="Collapsed">
        <Border.Style>
            <Style TargetType="Border">
                <Setter Property="Background" Value="White"/>
                <Style.Triggers>
                    <DataTrigger Binding="{Binding IsDarkTheme}" Value="True">
                        <Setter Property="Background" Value="#1E1E1E"/>
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </Border.Style>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="40"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <!-- 设置界面标题栏 -->
            <Border Grid.Row="0"
                    CornerRadius="10,10,0,0"
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown"
                    Cursor="Hand">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Background" Value="#F0F0F0"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsDarkTheme}" Value="True">
                                <Setter Property="Background" Value="#333333"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <Grid>
                    <TextBlock Text="设置"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Left"
                               Margin="15,0,0,0"
                               FontWeight="Bold">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="Black"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsDarkTheme}" Value="True">
                                        <Setter Property="Foreground" Value="White"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    <Button Content="×"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"
                            Width="20"
                            Height="20"
                            Margin="0,0,10,0"
                            Background="Transparent"
                            BorderThickness="0"
                            FontSize="14"
                            FontWeight="Bold"
                            Click="CloseSettings_Click"
                            Cursor="Hand">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Foreground" Value="Black"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsDarkTheme}" Value="True">
                                        <Setter Property="Foreground" Value="White"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </Grid>
            </Border>
            <!-- 设置内容区域 -->
            <TabControl Grid.Row="1"
                        Margin="10"
                        Background="Transparent"
                        BorderThickness="0">
                <TabControl.Resources>
                    <Style TargetType="TabItem" BasedOn="{StaticResource CustomTabItemStyle}"/>
                </TabControl.Resources>
                <!-- 基本设置页 -->
                <TabItem Header="基本设置">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="15">
                            <TextBlock Text="外观设置"
                                       FontWeight="Bold"
                                       Margin="0,0,0,15"
                                       FontSize="14">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Foreground" Value="Black"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsDarkTheme}" Value="True">
                                                <Setter Property="Foreground" Value="White"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            
                            <Grid Margin="0,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="始终置顶" FontWeight="Medium">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Foreground" Value="Black"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsDarkTheme}" Value="True">
                                                        <Setter Property="Foreground" Value="White"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                    <TextBlock Text="窗口始终保持在其他窗口之上" FontSize="11" Margin="0,2,0,0" x:Name="TopMostDescription">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Foreground" Value="Gray"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsDarkTheme}" Value="True">
                                                        <Setter Property="Foreground" Value="#AAAAAA"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </StackPanel>
                                <CheckBox x:Name="TopMostCheckBox"
                                          Grid.Column="1"
                                          IsChecked="True"
                                          Style="{StaticResource ModernToggleStyle}"
                                          Checked="TopMostCheckBox_Changed"
                                          Unchecked="TopMostCheckBox_Changed"/>
                            </Grid>
                            
                            <Separator Margin="0,8">
                                <Separator.Style>
                                    <Style TargetType="Separator">
                                        <Setter Property="Background" Value="#E0E0E0"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsDarkTheme}" Value="True">
                                                <Setter Property="Background" Value="#404040"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Separator.Style>
                            </Separator>
                            
                            <Grid Margin="0,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="在任务栏显示" FontWeight="Medium">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Foreground" Value="Black"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsDarkTheme}" Value="True">
                                                        <Setter Property="Foreground" Value="White"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                    <TextBlock Text="在Windows任务栏中显示应用图标" FontSize="11" Margin="0,2,0,0" x:Name="TaskbarDescription">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Foreground" Value="Gray"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsDarkTheme}" Value="True">
                                                        <Setter Property="Foreground" Value="#AAAAAA"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </StackPanel>
                                <CheckBox x:Name="ShowInTaskbarCheckBox"
                                          Grid.Column="1"
                                          IsChecked="True"
                                          Style="{StaticResource ModernToggleStyle}"
                                          Checked="ShowInTaskbarCheckBox_Changed"
                                          Unchecked="ShowInTaskbarCheckBox_Changed"/>
                            </Grid>
                            
                            <Separator Margin="0,8">
                                <Separator.Style>
                                    <Style TargetType="Separator">
                                        <Setter Property="Background" Value="#E0E0E0"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsDarkTheme}" Value="True">
                                                <Setter Property="Background" Value="#404040"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Separator.Style>
                            </Separator>
                            
                            <Grid Margin="0,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="夜间模式" FontWeight="Medium">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Foreground" Value="Black"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsDarkTheme}" Value="True">
                                                        <Setter Property="Foreground" Value="White"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                    <TextBlock Text="启用深色主题界面" FontSize="11" Margin="0,2,0,0" x:Name="DarkModeDescription">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Foreground" Value="Gray"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsDarkTheme}" Value="True">
                                                        <Setter Property="Foreground" Value="#AAAAAA"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </StackPanel>
                                <CheckBox x:Name="DarkThemeCheckBox"
                                          Grid.Column="1"
                                          IsChecked="{Binding IsDarkTheme, Mode=TwoWay}"
                                          Style="{StaticResource ModernToggleStyle}"
                                          Checked="DarkThemeCheckBox_Changed"
                                          Unchecked="DarkThemeCheckBox_Changed"/>
                            </Grid>
                            
                            <Separator Margin="0,15">
                                <Separator.Style>
                                    <Style TargetType="Separator">
                                        <Setter Property="Background" Value="#E0E0E0"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsDarkTheme}" Value="True">
                                                <Setter Property="Background" Value="#404040"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Separator.Style>
                            </Separator>
                            <TextBlock Text="其他设置"
                                       FontWeight="Bold"
                                       Margin="0,0,0,10"
                                       FontSize="14">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Foreground" Value="Black"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsDarkTheme}" Value="True">
                                                <Setter Property="Foreground" Value="White"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            <Button Content="重置所有设置"
                                    Background="#FF6B6B"
                                    Foreground="White"
                                    BorderThickness="0"
                                    Padding="10,5"
                                    Margin="0,10,0,0"
                                    Click="ResetSettings_Click"
                                    Cursor="Hand"
                                    Style="{StaticResource RoundedButtonStyle}"/>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>
                <!-- 对话模型设置页 -->
                <TabItem Header="对话模型设置">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <controls:ApiConfigControl x:Name="ApiConfigControl"/>
                    </ScrollViewer>
                </TabItem>
                <!-- TTS设置页 -->
                <TabItem Header="TTS设置">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <controls:TtsConfigControl x:Name="TtsConfigControl"/>
                    </ScrollViewer>
                </TabItem>
            </TabControl>
        </Grid>
    </Border>
</UserControl>