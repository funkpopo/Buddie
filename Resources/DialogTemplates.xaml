<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:local="clr-namespace:Buddie.Controls"
                    xmlns:buddie="clr-namespace:Buddie"
                    xmlns:loc="clr-namespace:Buddie.Localization">

  <!-- æ¶ˆæ¯æ°”æ³¡æ•°æ®æ¨¡æ¿ï¼ˆä»Ž Controls/DialogControl.xaml æ‹†åˆ†ï¼‰ -->
  <DataTemplate x:Key="MessageBubbleTemplate">
    <Border x:Name="MessageBubble"
            CornerRadius="18"
            Effect="{StaticResource CardShadow}">
      <Border.Style>
        <Style TargetType="Border">
          <Setter Property="Background" Value="#F0F0F0"/>
          <Setter Property="Margin" Value="10,5,50,5"/>
          <Setter Property="HorizontalAlignment" Value="Left"/>
          <Style.Triggers>
            <!-- ç”¨æˆ·æ¶ˆæ¯æ ·å¼ -->
            <DataTrigger Binding="{Binding IsUser}" Value="True">
              <Setter Property="Background" Value="#0084FF"/>
              <Setter Property="Margin" Value="50,5,10,5"/>
              <Setter Property="HorizontalAlignment" Value="Right"/>
            </DataTrigger>
            <!-- æ·±è‰²ä¸»é¢˜ä¸‹çš„AIæ¶ˆæ¯ -->
            <MultiDataTrigger>
              <MultiDataTrigger.Conditions>
                <Condition Binding="{Binding IsUser}" Value="False"/>
                <Condition Binding="{Binding DataContext.IsDarkTheme, RelativeSource={RelativeSource AncestorType=UserControl}}" Value="True"/>
              </MultiDataTrigger.Conditions>
              <Setter Property="Background" Value="#3A3A3C"/>
            </MultiDataTrigger>
          </Style.Triggers>
        </Style>
      </Border.Style>
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- å›¾ç‰‡å†…å®¹åŒºåŸŸ -->
        <Border Grid.Row="0"
                CornerRadius="8"
                Margin="8,8,8,4"
                BorderThickness="1"
                MaxWidth="250">
          <Border.Style>
            <Style TargetType="Border">
              <Setter Property="Visibility" Value="Collapsed"/>
              <Setter Property="BorderBrush" Value="#DDDDDD"/>
              <Style.Triggers>
                <DataTrigger Binding="{Binding HasImage}" Value="True">
                  <Setter Property="Visibility" Value="Visible"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding DataContext.IsDarkTheme, RelativeSource={RelativeSource AncestorType=UserControl}}" Value="True">
                  <Setter Property="BorderBrush" Value="#555555"/>
                </DataTrigger>
              </Style.Triggers>
            </Style>
          </Border.Style>
          <Image x:Name="MessageImage"
                 MaxHeight="200"
                 Stretch="Uniform"
                 ToolTip="{loc:Resx Tooltip_ImageContent}">
            <Image.Source>
              <Binding Path="ImageData">
                <Binding.Converter>
                  <buddie:ImageConverter/>
                </Binding.Converter>
              </Binding>
            </Image.Source>
          </Image>
        </Border>

        <!-- æ–‡æœ¬å†…å®¹ï¼šæ ¹æ®æ˜¯å¦Markdowné€‰æ‹©æŽ§ä»¶ -->
        <!-- éžMarkdownæ–‡æœ¬ -->
        <TextBlock Grid.Row="1"
                   Text="{Binding Content}"
                   Padding="12,8,12,8"
                   TextWrapping="Wrap"
                   MaxWidth="300"
                   FontSize="13"
                   LineHeight="18">
          <TextBlock.Style>
            <Style TargetType="TextBlock">
              <Setter Property="Foreground" Value="Black"/>
              <Setter Property="Visibility" Value="Visible"/>
              <Style.Triggers>
                <!-- éšè—TextBlockå½“å†…å®¹ä¸ºMarkdownæ—¶ -->
                <DataTrigger Binding="{Binding IsMarkdownContent}" Value="True">
                  <Setter Property="Visibility" Value="Collapsed"/>
                </DataTrigger>
                <!-- ç”¨æˆ·æ¶ˆæ¯æ–‡å­— -->
                <DataTrigger Binding="{Binding IsUser}" Value="True">
                  <Setter Property="Foreground" Value="White"/>
                </DataTrigger>
                <!-- æ·±è‰²ä¸»é¢˜ä¸‹çš„AIæ¶ˆæ¯æ–‡å­— -->
                <MultiDataTrigger>
                  <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding IsUser}" Value="False"/>
                    <Condition Binding="{Binding DataContext.IsDarkTheme, RelativeSource={RelativeSource AncestorType=UserControl}}" Value="True"/>
                  </MultiDataTrigger.Conditions>
                  <Setter Property="Foreground" Value="White"/>
                </MultiDataTrigger>
              </Style.Triggers>
            </Style>
          </TextBlock.Style>
        </TextBlock>

        <!-- Markdownæ¸²æŸ“ -->
        <RichTextBox Grid.Row="1"
                     local:DialogControl.BindableDocument="{Binding RenderedDocument}"
                     Padding="12,8,12,8"
                     MaxWidth="300"
                     FontSize="13"
                     IsReadOnly="True"
                     BorderThickness="0"
                     VerticalScrollBarVisibility="Disabled"
                     HorizontalScrollBarVisibility="Disabled">
          <RichTextBox.Style>
            <Style TargetType="RichTextBox">
              <Setter Property="Background" Value="Transparent"/>
              <Setter Property="Foreground" Value="Black"/>
              <Setter Property="Visibility" Value="Collapsed"/>
              <Style.Triggers>
                <!-- æ˜¾ç¤ºRichTextBoxå½“å†…å®¹ä¸ºMarkdownæ—¶ -->
                <DataTrigger Binding="{Binding IsMarkdownContent}" Value="True">
                  <Setter Property="Visibility" Value="Visible"/>
                </DataTrigger>
                <!-- ç”¨æˆ·æ¶ˆæ¯æ–‡å­— -->
                <DataTrigger Binding="{Binding IsUser}" Value="True">
                  <Setter Property="Foreground" Value="White"/>
                </DataTrigger>
                <!-- æ·±è‰²ä¸»é¢˜ä¸‹çš„AIæ¶ˆæ¯æ–‡å­— -->
                <MultiDataTrigger>
                  <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding IsUser}" Value="False"/>
                    <Condition Binding="{Binding DataContext.IsDarkTheme, RelativeSource={RelativeSource AncestorType=UserControl}}" Value="True"/>
                  </MultiDataTrigger.Conditions>
                  <Setter Property="Foreground" Value="White"/>
                </MultiDataTrigger>
              </Style.Triggers>
            </Style>
          </RichTextBox.Style>
        </RichTextBox>

        <!-- ç”¨æˆ·æ¶ˆæ¯æŒ‰é’®åŒºåŸŸ -->
        <StackPanel Grid.Row="2"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,0,8,5">
          <StackPanel.Style>
            <Style TargetType="StackPanel">
              <Setter Property="Visibility" Value="Collapsed"/>
              <Style.Triggers>
                <DataTrigger Binding="{Binding IsUser}" Value="True">
                  <Setter Property="Visibility" Value="Visible"/>
                </DataTrigger>
              </Style.Triggers>
            </Style>
          </StackPanel.Style>
          <!-- å¤åˆ¶æŒ‰é’® -->
          <Button Content="ðŸ“‹"
                  Width="24"
                  Height="24"
                  Background="Transparent"
                  BorderThickness="0"
                  FontSize="12"
                  Cursor="Hand"
                  ToolTip="{loc:Resx Tooltip_Copy}"
                  Command="{Binding DataContext.CopyMessageCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                  CommandParameter="{Binding Content}"/>
        </StackPanel>

        <!-- AIæ¶ˆæ¯æŒ‰é’®åŒºåŸŸ -->
        <StackPanel Grid.Row="2"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,0,8,5">
          <StackPanel.Style>
            <Style TargetType="StackPanel">
              <Setter Property="Visibility" Value="Collapsed"/>
              <Style.Triggers>
                <!-- åªæœ‰AIæ¶ˆæ¯ä¸”æœ‰TTSé…ç½®æ—¶æ˜¾ç¤º -->
                <MultiDataTrigger>
                  <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding IsUser}" Value="False"/>
                    <Condition Binding="{Binding DataContext.HasActiveTtsConfiguration, RelativeSource={RelativeSource AncestorType=UserControl}}" Value="True"/>
                  </MultiDataTrigger.Conditions>
                  <Setter Property="Visibility" Value="Visible"/>
                </MultiDataTrigger>
              </Style.Triggers>
            </Style>
          </StackPanel.Style>
          <!-- å¤åˆ¶æŒ‰é’® -->
          <Button Content="ðŸ“‹"
                  Width="24"
                  Height="24"
                  Background="Transparent"
                  BorderThickness="0"
                  FontSize="12"
                  Cursor="Hand"
                  ToolTip="{loc:Resx Tooltip_Copy}"
                  Command="{Binding DataContext.CopyMessageCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                  CommandParameter="{Binding Content}"/>
          <!-- TTSæŒ‰é’® -->
          <Button Content="ðŸ”Š"
                  Width="24"
                  Height="24"
                  Background="Transparent"
                  BorderThickness="0"
                  FontSize="12"
                  Margin="5,0,0,0"
                  Cursor="Hand"
                  ToolTip="{loc:Resx Tooltip_ReadAloud}"
                  Command="{Binding DataContext.PlayTtsCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                  CommandParameter="{Binding Content}"/>
        </StackPanel>
      </Grid>
    </Border>
  </DataTemplate>

</ResourceDictionary>
